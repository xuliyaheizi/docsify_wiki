# Mysql

## Q&A

### 数据库的三范式？

- 第一范式：列不可再分
- 第二范式：行可以唯一区分，主键约束
- 第三范式：表的非主属性不能依赖与其他表的非主属性外键约束

三大范式是一级一级依赖的，第二范式建立在第一范式上，第三范式建立在第一第二范式上。

### Mysql的数据库引擎？

```mysql
mysql> show engines
```

<img src="https://knowledgeimagebed.oss-cn-hangzhou.aliyuncs.com/img/202207081010554.png" alt="image-20220708101035699" width="80%;" />

`mysql常用引擎包括`：MYISAM、Innodb、Memory、MERGE

- MYISAM：全表锁，拥有较高的执行速度，不支持事务，不支持外键，并发性能差，占用空间相对较小，对事务完整性没有要求，以select、insert为主的应用基本上可以使用这引擎。
- Innodb:行级锁，提供了具有提交、回滚和崩溃回复能力的事务安全，支持自动增长列，支持外键约束，并发能力强，占用空间是MYISAM的2.5倍，处理效率相对会差一些。
- Memory:全表锁，存储在内容中，速度快，但会占用和数据量成正比的内存空间且数据在mysql重启时会丢失，默认使用HASH索引，检索效率非常高，但不适用于精确查找，主要用于那些内容变化不频繁的代码表。
- MERGE：是一组MYISAM表的组合

### 事务？

**什么是事务：**多条SQL语句，要么全部成功，要么全部失败。

**事务的特性：**数据库的事务特性有`原子性（Atomic）`、`一致性（Consistency）`、`隔离性（Isolation）`、`持久性（Durailiy）`，简称ACID。

- 原子性：组成一个事务的多个数据库操作是一个不可分割的原子单元，必须所有操作都成功，事务才会提交。任何一个操作失败，已经执行的任何操作都必须撤销，让数据库返回初始状态。
- 一致性：事务操作成功后，数据库所处的状态和它的业务规则是一致的。即数据不会被破坏。如A转账100元给B，不管操作是否成功，A和B的账户总额是不变的。
- 隔离性：在并发数据操作时，不同的事务拥有各自的数据空间，它们的操作不会对彼此产生干扰。
- 持久性：一旦事务提交成功，事务中的所有操作都必须持久化到数据库中。

### 索引

MySQL索引的建立对于MySQL的高效运行是很重要的，索引可以`大大提高MySQL的检索速度`。索引相当于一本书的目录，能加快数据库的查询速度。

索引也是`一张表`，该表保存了`主键`与`索引字段`，并`指向实体表的记录`。一般来说，索引本身很大，不可能全部存储在内存中，因此索引往往是存储在磁盘上的文件中的（可能存储在单独的索引文件中，也可能和数据一起存储在数据文件中）。

索引包括`聚集索引`、`覆盖索引`、`组合索引`、`前缀索引`、`唯一索引`等，没有特别说明，默认都是使用B+树结构组织（多路搜索树，并不一定是二叉树）的索引。

**缺点：**索引可大大提高查询速度，同时去也会`降低更新表的速度`，如对表进行INSERT、UPDATE和DELETE。在更新表时，MySql不仅要保存数据，还要保存一下索引文件，建立索引会占用磁盘空间的索引文件。

### InnoDB与MyISAM的区别？

1. InnoDB支持事务，MyISAM不支持，对于InnoDB每一条SQL语言都默认封装成事务，自动提交，这样会影响速度，所以最好把多条SQL语言放在begin和commit之间，组成一个事务；
2. InnoDB支持外键，而MyISAM不支持。对一个包含外键的InnoDB表转为MYISAM会失败；
3. InnoDB是聚集索引，数据文件是和索引绑在一起的，必须要有主键，通过主键索引效率很高。但是辅助索引需要两次查询，先查询到主键，然后再通过主键查询到数据。因此，主键不应该过大，因为主键太大，其他索引也都会很大。而MyISAM是非聚集索引，数据文件是分离的，索引保存的是数据文件的指针。主键索引和辅助索引是独立的。
4. InnoDB不保存表的具体行数，执行select count(*) from table时需要全表扫描。而MyISAM用一个变量保存了整个表的行数，执行上述语句时只需要读出该变量即可，速度很快；
5. Innodb不支持全文索引，而MyISAM支持全文索引，查询效率上MyISAM要高；

### SQL优化方案？

1. 查询语句中不要使用select *

2. 尽量减少子查询，使用关联查询（left join,right join,inner join）替代

3. 减少使用IN或者NOT IN ,使用exists，not exists或者关联查询语句替代

4. or 的查询尽量用 union或者union all 代替(在确认没有重复数据或者不用剔除重复数据时，union all会更好) 

5. 应尽量避免在 where 子句中使用!=或<>操作符，否则将引擎放弃使用索引而进行全表扫描。

6. 应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如： `select id from t where num is null 可以在num上设置默认值0，确保表中num列没有null值，然后这样查询： select id from t where num=0`

### drop、delete和truncate的区别？

delete和truncate只删除表的数据而不删除表的结构，速度一般来说：drop>truncate>delete。delete语句是dml，这个操作会放到rollback segement中，事务提交之后才生效。如果有相应的trigger（触发器），执行的时候将被触发。

truncate和drop是ddl，操作立即生效，原数据不放到rollback segment中，不能回滚，操作不能触发trigger。

- DML（data manipulation language）是数据操纵语言：它们是SELECT、UPDATE、INSERT、DELETE，就象它的名字一样，这4条命令是用来对数据库里的数据进行操作的语言。
- DDL（data definition language）是数据定义语言：DDL比DML要多，主要的命令有CREATE、ALTER、DROP等，DDL主要是用在定义或改变表（TABLE）的结构，数据类型，表之间的链接和约束等初始化工作上，他们大多在建立表时使用。
- DCL（DataControlLanguage）是数据库控制语言：是用来设置或更改数据库用户或角色权限的语句，包括（grant,deny,revoke等）语句。

### 什么是视图？

视图是一种虚拟的表，具有和物理表相同的功能。可以对视图进行增，改，查，操作，试图通常是有一个表或者多个表的行或列的子集。对视图的修改不影响基本表。它使得我们获取数据更容易，相比多表查询。

